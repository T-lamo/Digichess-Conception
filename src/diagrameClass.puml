@startuml
'-------------------------------
' Configuration générale
'-------------------------------
left to right direction
skinparam classMargin 10
skinparam classPadding 15
skinparam linetype ortho
skinparam classFontSize 16
skinparam noteFontSize 14
skinparam ArrowFontSize 20

'-------------------------------
' Interfaces
'-------------------------------
interface IPersonne {
    + getNom(): string
    + getPrenom(): string
    + getAdresse(): string
    + getCodePostal(): string
    + getVille(): string
    + getEmail(): string
}

'-------------------------------
' Classes principales
'-------------------------------
class Client {
    - idClient: int
    - codeClient: string
    - nom: string
    - prenom: string
    - genre: string
    - adresse1: string
    - adresse2: string
    - adresse3: string
    - codePostal: string
    - ville: string
    - telephone: string
    - email: string
    - newsletter: bool
    - pointsFidelite: int
    - dateCreation: Date
    - statut: string
    - listeCommandes: List<Commande>
    + envoyerPoints(points: int)
    + recevoirColis(colis: Colis)
}
Client ..|> IPersonne

note right of Client
Tous les champs sont obligatoires sauf :
- adresse2
- adresse3
- email
- newsletter
end note

class Emplacement {
    - idEmplacement: int
    - numero: int
    - nom: string
    - ville: string
    - departement: string
    - description: string
}
note right of Emplacement
Cette table pourra être utilisée pour 
alimenter certains écrans :
  - Gestion des emplacements
  - Proposition des codes postaux
end note


class Commande {
    - idCommande: int
    - dateCreation: Date
    - dateLivraison: Date
    - etat: string
    - numeroSuivi: string
    - client: Client
    - listeLignes: List<LigneCommande>
    - colis: Colis
    - commentaires: string
    + valider()
    + mettreEnAttente()
    + archiver()
}

class LigneCommande {
    - idLigne: int
    - article: Article
    - quantite: int
    - prixUnitaire: float
    - pointsTotaux: int
    + calculerPoints(): int
    + estValide(stock: Stock): bool
}

class Article {
    - idArticle: int
    - nom: string
    - description: string
    - pointsRequis: int
    - poids: float
    - quantiteMin: int
    - quantiteMax: int
    - stockDisponible: int
    + estDisponible(stock: Stock, quantite: int): bool
}

class Stock {
    - articlesDisponibles: List<Article>
    - dateMiseAJour: Date
    + verifierDisponibilite(article: Article, quantite: int): bool
    + mettreAJour(article: Article, quantite: int)
}

class Colis {
    - idColis: int
    - poidsTotal: float
    - emballage: Emballage
    - listeLignes: List<LigneCommande>
    - dateExpedition: Date
    - modeEnvoi: string
    - fraisAffranchissement: float
    + calculerPoidsTotal()
    + calculerAffranchissement(listeTarifs: List<TarifPostal>)
    + choisirEmballage(lignes: List<LigneCommande>, listeEmballages: List<Emballage>): Emballage
}

class Emballage {
    - idEmballage: int
    - nom: string
    - quantiteMinParArticle: Map<Article, int>
    - quantiteMaxParArticle: Map<Article, int>
    - poidsMax: float
    - dimensions: string
    - typeMateriau: string
}

class ModeleEmballage {
    - idModele: int
    - nom: string
    - listeEmballages: List<Emballage>
    - description: string
}

class TarifPostal {
    - idTarif: int
    - tranchePoidsMin: float
    - tranchePoidsMax: float
    - tarif: float
    - dateDebutValidite: Date
    - dateFinValidite: Date
}

'-------------------------------
' Classes des utilisateurs
'-------------------------------
class Utilisateur {
    - idUtilisateur: int
    - nom: string
    - login: string
    - motDePasse: string
    - role: string
}
Utilisateur ..|> IPersonne

class OperateurColis {
    + recevoirCourrier()
    + verifierContenuCourrier()
    + preparerColis()
    + calculerConditionnement()
    + calculerPoidsTotal()
    + calculerFraisAffranchissement(listeTarifs: List<TarifPostal>)
    + genererImpressions()
    + envoyerNotificationEmail()
}
OperateurColis -|> Utilisateur

class OperateurStock {
    + verifierDisponibiliteStock()
    + mettreAJourStock()
}
OperateurStock -|> Utilisateur

class Administrateur {
    + paramétrerEmballages()
    + paramétrerTarifsAffranchissement(listeTarifs: List<TarifPostal>)
    + paramétrerPoidsArticles()
    + definirQuantitesMinMaxParArticle()
    + creerModelesEmballage()
    + gererUtilisateurs()
}
Administrateur -|> Utilisateur

'-------------------------------
' Relations avec position stratégique et cardinalités
'-------------------------------

' Clients et Commandes
Client "1" -down-> "*" Commande : passe
Commande "1" -down-> "*" LigneCommande : contient
LigneCommande "1" -right-> "1" Article : correspond à
Commande "1" -right-> "1" Colis : genere
Colis "1" -down-> "1" Emballage : utilise
Colis "1" -right-> "*" TarifPostal : utilise
ModeleEmballage "1" -down-> "*" Emballage : contient
Stock "1" -down-> "*" Article : contient

' Utilisateurs
OperateurColis "1" -up-> "*" Commande : gere
OperateurColis "1" -right-> "*" Colis : prepare
OperateurColis "1" -down-> "*" TarifPostal : utilise
OperateurStock "1" -up-> "*" Stock : supervise
Administrateur "1" -down-> "*" Emballage : parametre
Administrateur "1" -down-> "*" ModeleEmballage : cree
Administrateur "1" -right-> "*" TarifPostal : parametre

@enduml
